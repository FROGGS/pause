=head1 CONSTRUCTION WORKS 2003-07-24 and following

The README is partially outdated while work is going on on PAUSE.

=head1 PAUSE repository

This repository lives at

    http://pause.perl.org:5459/svn/pause/trunk
    (for writers: https://pause.perl.org:5460/svn/pause/trunk)

and is considered to contain all relevant programs and configuration
data for running pause.perl.org except for the SSL key and certificate
and files containing passwords or other sensible data. To access the
repository you need a subversion client (subversion.tigris.org).

If you do not have a subversion client, a tarball of the repository is
produced by a cronjob and accessible as in the directory

    ftp://pause.perl.org/pub/PAUSE/PAUSE-code/

The filenames of the snapshots in that directory match
C< /^pause-wc-(\d+)\.tar\.gz$/ > where C< $1 > is the revision number of
the repository.

=head2 Excluded files

The following file has been excluded from the repository for obvious
reasons:

    privatelib/PrivatePAUSE.pm

PrivatePAUSE.pm contains only the usernames and passwords of the mysql
users that own the two databases. See below for "Database schema".

Other sensitive files, like the SSL key of the server, password files
need to be maintained separately from the repository. See below the
section about user management.

=head2 File system layout

On PAUSE the files live in /home/k/PAUSE and the following symlinks
make sure that installed programs find their configuration:

(last time updated: 2003-07-25)

  /usr/local/apache/conf          -> ../../../home/k/PAUSE/apache-conf
  /usr/local/apache/htdocs        -> ../../../home/k/PAUSE/htdocs/
  /usr/local/apache/perl          -> ../../../home/k/PAUSE/apache-perl
  /etc/apache2/apache2.conf       -> /home/k/PAUSE/apache-svn-conf/httpd.conf
  /etc/apache2/mods-available/ssl.conf -> /home/k/PAUSE/apache-svn-conf/ssl.conf
  /etc/rsyncd.conf                -> /home/k/PAUSE/etc/rsyncd.conf
  /etc/proftpd.conf               -> /home/k/PAUSE/etc/proftpd.conf
  /etc/mon/mon.cf                 -> /home/k/PAUSE/etc/mon/mon.cf
  /usr/lib/mon/mon.d/paused.monitor -> /home/k/PAUSE/etc/mon/mon.d/paused.monitor

[ (last time updated: 2002-12-25)

  /etc/cron.jobs/indexscripts.pl -> ../../home/kstar/cron/indexscripts.pl
  /etc/rc.d/init.d/httpd -> /home/k/PAUSE/etc/rc.d/init.d/httpd
  /etc/rc.d/init.d/httpd-svn -> /home/k/PAUSE/etc/rc.d/init.d/httpd-svn
  /etc/security/limits.conf -> /home/k/PAUSE/etc/security/limits.conf
  /usr/local/mirror/mirror.defaults -> ../../../home/k/PAUSE/mirror/mirror.defaults
  /usr/local/mirror/mymirror.config -> ../../../home/k/PAUSE/mirror/mymirror.config
]

(XXX reduce the number of necessary symlink)

(XXX integrate indexscripts.pl with the help of kstar)

=head2 External programs to run PAUSE

  apache with mod_perl and Apache-SSL
  perl
  mirror (the good old one)
  mon
  proftpd
  mysqld
  rsync (runs as daemon)
  subversion (optional)
  gpg
  unzip

At the time of this writing (2003-07-25), all perl scripts were
running under 5.8.0.

=head2 Database schema

The files doc/*.schema.txt document the schema of the two databases. A
dump of the mod database is produced every few hours and available for
download in the ftp area. A dump of the authen_pause database is -- of
course -- not available.

=head2 User management

This section is about the fun of makeing mysql safe based on UNIX user
and group permissions. This is dangerous stuff. Be careful here and
follow the advice in the mysql manual about how to secure mysql in
general. E.g. --skip-networking and root user password are a must,
etc.

PAUSE is running processes as user root, nobody, SVN, ftp, and UNSAFE.
The user "k" in the group "k" owns the working copy of the repository
and all the sensitive files. Group "k" must contain all users who
should be able to read sensitive data. So at least "nobody" (who runs
the webserver) must be in that group. Sensitive directories and files
must be group-readable and must not be world readable. The SSL data
for the webservers should not even be readable by that group, only by
root who starts the webservers.

This setup must ensure that the user UNSAFE cannot read the database
account informations. On the database side this is achieved by
granting delete,index,insert,select,update privileges on the two
tables, nothing else, to one user. This is the user whose access codes
are stored in PrivatePAUSE.pm. The root password to mysql is not
needed by any script, so can be stored offline.

=head2 Other security considerations

We practice security by visibility by giving the users as much
information as possible about the status of their requests. This is
mostly done by sending them mail about every action they take.

Another important axiom is that we disallow overwriting of files
except for pure documentation files. That way the whole CPAN cannot
fall out of sync and inconsistencies can be tracked easily. It opens
us the possibility to maintain a I<backpan>, a backup of all relevant
files of all times. Any attempt to upload malicious code can thus be
tracked much better.

=head2 Missing pieces

As always, there are things we didn't bother to integrate into the
repository because they are so basic stuff for any UNIX machine:

  logrotate
  xntpd
  sendmail

and probably more. If you discover pieces that are important but
missing in the repository, please let us know.

=cut
